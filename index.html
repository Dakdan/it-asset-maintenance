<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>IT Maintenance System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="style.css">

<style>
.hidden{display:none}
input,select,textarea,button{
 width:100%;padding:10px;margin-top:8px;
 border-radius:8px;border:1px solid #ddd;
}
button{background:#ff5fa2;color:#fff;font-weight:bold}
.card{margin-bottom:15px}
.status-new{color:#ff9800;font-weight:bold}
.status-work{color:#2196f3;font-weight:bold}
.status-done{color:#4caf50;font-weight:bold}
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid #eee;padding:8px;font-size:14px}
</style>
</head>

<body>

<header class="app-header">
  <div>
    <div class="app-title">‚õë IT Maintenance</div>
    <div class="app-subtitle" id="userInfo"></div>
  </div>
</header>

<main>

<!-- REGISTER -->
<div class="card" id="registerBox">
<h3>üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà IT</h3>
<input id="r_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•">
<input id="r_email" placeholder="Email">
<input id="r_pass" type="password" placeholder="Password">
<input id="r_pos" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
<button onclick="register()">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
<p id="r_msg"></p>
</div>

<!-- VERIFY -->
<div class="card hidden" id="verifyBox">
<h3>üìß ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô Email</h3>
<input id="v_email" placeholder="Email">
<input id="v_code" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô">
<button onclick="verify()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
<p id="v_msg"></p>
</div>

<!-- LOGIN -->
<div class="card hidden" id="loginBox">
<h3>üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö IT</h3>
<input id="l_email" placeholder="Email">
<input id="l_pass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<p id="l_msg"></p>
</div>

<!-- DASHBOARD -->
<div class="hidden" id="dashboard">

<div class="card">
<h3>‚ûï ‡πÄ‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (IT ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ)</h3>
<select id="jobType"></select>
<select id="jobSubType"></select>
<textarea id="problem" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤"></textarea>
<input id="contact" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö">
<button onclick="createJob()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</button>
</div>

<div class="card">
<h3>üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
<th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
<th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
</tr>
</thead>
<tbody id="jobTable"></tbody>
</table>
</div>

</div>

</main>

<script src="js/api.js"></script>
<script src="js/main.js"></script>

<script>
const token = localStorage.getItem("it_token");

/* AUTO LOGIN */
if(token){
 apiPost({action:"checkToken",token}).then(r=>{
  if(r.valid){
   showDashboard();
  }else{
   showLogin();
  }
 });
}else{
 showRegister();
}

function showRegister(){
 hideAll(); document.getElementById("registerBox").classList.remove("hidden");
}
function showVerify(){
 hideAll(); document.getElementById("verifyBox").classList.remove("hidden");
}
function showLogin(){
 hideAll(); document.getElementById("loginBox").classList.remove("hidden");
}
function showDashboard(){
 hideAll();
 document.getElementById("dashboard").classList.remove("hidden");
 document.getElementById("userInfo").innerText =
  JSON.parse(localStorage.getItem("it_user")).name +
  " ("+JSON.parse(localStorage.getItem("it_user")).position+")";
 loadJobType(); loadJobs();
}
function hideAll(){
 ["registerBox","verifyBox","loginBox","dashboard"]
 .forEach(i=>document.getElementById(i).classList.add("hidden"));
}

/* REGISTER */
function register(){
 apiPost({
  action:"registerIT",
  name:r_name.value,
  email:r_email.value,
  password:r_pass.value,
  position:r_pos.value
 }).then(r=>{
  if(r.success){
   v_email.value=r_email.value;
   showVerify();
  }else r_msg.innerText="‚ùå Email ‡∏ã‡πâ‡∏≥";
 });
}

/* VERIFY */
function verify(){
 apiPost({
  action:"verifyEmail",
  email:v_email.value,
  code:v_code.value
 }).then(r=>{
  if(r.success) showLogin();
  else v_msg.innerText="‚ùå ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
 });
}

/* LOGIN */
function login(){
 apiPost({
  action:"loginIT",
  email:l_email.value,
  password:l_pass.value
 }).then(r=>{
  if(r.success){
   localStorage.setItem("it_token",r.token);
   localStorage.setItem("it_user",JSON.stringify(r));
   showDashboard();
  }else l_msg.innerText="‚ùå Login ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô";
 });
}
</script>

</body>
</html>
