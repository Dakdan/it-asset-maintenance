<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ระบบสำรวจครุภัณฑ์คอมพิวเตอร์</title>
  <script src="./config.js"></script>
</head>
<body style="font-family:sans-serif">

<h2>ระบบสำรวจครุภัณฑ์คอมพิวเตอร์</h2>
<h3>โรงพยาบาลอุดรธานี</h3>

<hr>

<label>Username</label><br>
<input id="user"><br><br>

<label>Password</label><br>
<input id="pass" type="password"><br><br>

<button onclick="login()">เข้าสู่ระบบ</button>

<p id="msg" style="color:red"></p>

<script>
function login(){
  if(typeof api !== "function"){
    msg.innerText = "config.js ไม่ถูกโหลด";
    return;
  }

  const u = user.value;
  const p = pass.value;

  api("login",{username:u,password:p})
    .then(res=>{
      if(res.success){
        localStorage.setItem("role",res.role);
        localStorage.setItem("dept",res.dept);
        location.href = "dashboard.html";
      }else{
        msg.innerText="ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง";
      }
    })
    .catch(err=>{
      msg.innerText = "เชื่อมต่อ API ไม่ได้";
      console.error(err);
    });
}
</script>

</body>
</html>
