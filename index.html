<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>IT UDH Maintenance & Service</title>
<style>
body {
  font-family: sans-serif;
  background: linear-gradient(135deg,#ff5fa2,#ffffff);
  margin: 0;
}
header {
  background:#fff;
  padding:15px;
  border-bottom:4px solid #ff5fa2;
  display:flex;
  align-items:center;
  gap:10px;
}
header img { height:40px; }
.container {
  padding:15px;
}
.input {
  width:100%;
  padding:10px;
  margin:6px 0;
  border:1px solid #ff5fa2;
  border-radius:8px;
}
button {
  background:#ff5fa2;
  color:#fff;
  border:none;
  padding:10px 16px;
  border-radius:8px;
}
table {
  width:100%;
  border-collapse:collapse;
  background:#fff;
}
th,td {
  border:1px solid #ffd1e3;
  padding:6px;
}
</style>
</head>

<body>

<header>
  <img src="https://i.imgur.com/LOGO.png">
  <strong>IT UDH Maintenance & Service</strong>
</header>

<div class="container">

<h3>เข้าสู่ระบบ IT</h3>
<input id="u" class="input" placeholder="Username">
<input id="p" type="password" class="input" placeholder="Password">
<button onclick="login()">Login</button>

<hr>

<h3>สร้าง / รับงาน</h3>

<select id="jobType" class="input" onchange="loadSubType()">
  <option value="">เลือกประเภทงาน</option>
</select>

<select id="jobSubType" class="input">
  <option value="">เลือกงานย่อย</option>
</select>

<hr>

<h3>งานทั้งหมด</h3>
<table id="tbl"></table>

</div>

<script>
let itName = '';

function login() {
  google.script.run.withSuccessHandler(res=>{
    if(res.success){
      itName = res.name;
      alert('ยินดีต้อนรับ '+res.name);
      loadJobType();
      loadTickets();
    } else {
      alert('Login ไม่ถูกต้อง');
    }
  }).itLogin(u.value,p.value);
}

function loadJobType(){
  google.script.run.withSuccessHandler(data=>{
    data.forEach(r=>{
      jobType.innerHTML += `<option value="${r[0]}">${r[1]}</option>`;
    });
  }).getJobTypes();
}

function loadSubType(){
  jobSubType.innerHTML='<option value="">เลือกงานย่อย</option>';
  google.script.run.withSuccessHandler(data=>{
    data.forEach(r=>{
      jobSubType.innerHTML += `<option value="${r[0]}">${r[2]}</option>`;
    });
  }).getJobSubTypes(jobType.value);
}

function loadTickets(){
  google.script.run.withSuccessHandler(data=>{
    let h = '<tr><th>JobID</th><th>ปัญหา</th><th>สถานะ</th></tr>';
    for(let i=1;i<data.length;i++){
      h+=`<tr>
        <td>${data[i][0]}</td>
        <td>${data[i][8]}</td>
        <td>${data[i][10]}</td>
      </tr>`;
    }
    tbl.innerHTML=h;
  }).getAllTickets();
}
</script>

</body>
</html>
